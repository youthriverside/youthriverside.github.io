<!DOCTYPE html><html lang="zh-CN"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><meta name="author" content="åˆ˜æ¸¤æº,youthriverside@outlook.com"><title>ğŸš—åŸºäºC++çš„ESP32å°è½¦æ§åˆ¶ç³»ç»Ÿ Â· è´Ÿé›¨æ‚æ„Ÿ</title><meta name="description" content="æœ¬ä»£ç å·²åœ¨Githubå¼€æº
    å¼€æºåè®®ä¸ºGPL-3.0
    ç‚¹å‡»æ­¤å¤„è¿›å…¥é¡¹ç›®é¡µé¢
    

ESP32 Smart Car Control System
Introduction

This project is for the curriculum design of Programm"><meta name="keywords" content="éšç¬”,é’æ˜¥,è®°å½•,æ ¡å›­,è¯—æ­Œ,æƒ…æ„Ÿ,ç›¸æ€,æŠ€æœ¯"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="renderer" content="webkit"><link rel="short icon" href="/images/favicon.png" type="image/x-icon"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/blog_basic.css"><link rel="stylesheet" href="/css/font-awesome.min.css"><link rel="alternate" type="application/atom+xml" title="ATOM 1.0" href="/atom.xml"><meta name="generator" content="Hexo 4.2.1"></head><body><div class="sidebar animated fadeInDown"><div class="logo-title"><div class="title"><img src="/images/logo@2x.png" style="width:127px;"><h3 title=""><a href="/">è´Ÿé›¨æ‚æ„Ÿ</a></h3></div></div><ul class="social-links"><li><a href="https://twitter.com/LiuBoyuan10" target="_blank" rel="noopener"><i class="fa fa-twitter"></i></a></li><li><a href="https://liuboyuan.fun/atom.xml"><i class="fa fa-rss"></i></a></li><li><a href="http://facebook.com/boyuan.liu.9678" target="_blank" rel="noopener"><i class="fa fa-facebook"></i></a></li><li><a href="http://github.com/youthriverside" target="_blank" rel="noopener"><i class="fa fa-github"></i></a></li></ul><div class="footer"><a target="_blank" href="/"></a><span> </span><a href="https://liuboyuan.fun">Â©åˆ˜æ¸¤æº</a><br><a href="http://beian.miit.gov.cn" target="_blank" rel="noopener">é»‘ICPå¤‡20000740å·</a><br><div class="by_farbox"></div></div></div><div class="main"><div class="page-top animated fadeInDown"><div class="nav"><li><a href="/">é¦–é¡µ</a></li><li><a href="/zhihelinyou">å‹é“¾</a></li><li><a href="/birenziyun">è‡ªè¨€</a></li><li><a href="/archives">å½’æ¡£</a></li><li><a href="/privacy-policy">å…³äº</a></li></div><div class="information"><div class="back_btn"><li><a class="fa fa-chevron-left" onclick="window.history.go(-1)"> </a></li></div><div class="avatar"><img src="/images/favicon.png"></div></div></div><div class="autopagerize_page_element"><div class="content"><div class="post-page"><div class="post animated fadeInDown"><div class="post-title"><h3><a>ğŸš—åŸºäºC++çš„ESP32å°è½¦æ§åˆ¶ç³»ç»Ÿ</a></h3></div><div class="post-content"><div class="tip">
    æœ¬ä»£ç å·²åœ¨Githubå¼€æº<br>
    å¼€æºåè®®ä¸ºGPL-3.0<br>
    <a href="https://github.com/youthriverside/ESP32-Smart-Car-Control-System" target="_blank" rel="noopener">ç‚¹å‡»æ­¤å¤„</a>è¿›å…¥é¡¹ç›®é¡µé¢
    <br>
</div>
<h1>ESP32 Smart Car Control System</h1>
<h2 id="Introduction">Introduction</h2>
<div class="tip">
This project is for the curriculum design of Programming Logic and Methodology of ZhiXing College, DUT.
The above code is for academic reference only. Any consequences arising from improper use of the code are the sole responsibility of the user.
</div>
The ESP32 Smart Car Control System is an innovative project that realizes hardware-software interaction between a computer and a microcontroller based on the C++ serial port module and the ESP32 microprocessor chip. This system mediates the transmission of string commands or corresponding data frames recognizable by the microcontroller through serial communication, enabling the car to move forward, backward, turn quickly, and adjust speed via PWM (Pulse Width Modulation). The system is easy to operate with a high fault tolerance rate, and it is equipped with an XOR bit self-identification, self-calculation, and self-verification module for data frames, reducing the probability of misidentifying commands. Additionally, this system can efficiently receive status data transmitted back from the ESP32 Smart Car, simplify the processing of the returned data, and clearly display it on the console, achieving precise control of the ESP32 Smart Car.  
## Code
### main.cpp
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iomanip&gt; </span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;Windows.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;sstream&gt; </span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"serial.h"</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="keyword">extern</span> <span class="built_in">string</span> receivedData;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">displayMenuAndStatus</span><span class="params">(<span class="keyword">const</span> <span class="built_in">string</span>&amp; carStatus, <span class="keyword">double</span> PWM_L, <span class="keyword">double</span> PWM_R, <span class="keyword">double</span> Speed_L, <span class="keyword">double</span> Speed_R)</span> </span>&#123;</span><br><span class="line">	<span class="comment">//æ˜¾ç¤ºèœå•å’Œå°è½¦çŠ¶æ€</span></span><br><span class="line">    system(<span class="string">"cls"</span>);</span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; <span class="string">"é€‰æ‹©æ“ä½œ:\n"</span>;</span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; <span class="string">"1. å‰è¿›\n"</span>;</span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; <span class="string">"2. åé€€\n"</span>;</span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; <span class="string">"3. å·¦è½¬\n"</span>;</span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; <span class="string">"4. å³è½¬\n"</span>;</span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; <span class="string">"5. å¿«é€Ÿå·¦è½¬\n"</span>;</span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; <span class="string">"6. å¿«é€Ÿå³è½¬\n"</span>;</span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; <span class="string">"7. è®¾ç½®é€Ÿåº¦ï¼ˆå•è½®/PWM)\n"</span>;</span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; <span class="string">"8. åœæ­¢\n"</span>;</span><br><span class="line">	<span class="built_in">cout</span> &lt;&lt; <span class="string">"9. åˆ·æ–°çŠ¶æ€\n"</span>;</span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; <span class="string">"0. é€€å‡º\n\n"</span>;</span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; <span class="string">"çŠ¶æ€: "</span> &lt;&lt; carStatus &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; <span class="string">"å·¦è½®PWM: "</span> &lt;&lt; PWM_L &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">	<span class="built_in">cout</span> &lt;&lt; <span class="string">"å·¦è½®é€Ÿåº¦: "</span> &lt;&lt; Speed_L &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; <span class="string">"å³è½®PWM: "</span> &lt;&lt; PWM_R &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; <span class="string">"å³è½®é€Ÿåº¦: "</span> &lt;&lt; Speed_R &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">	<span class="built_in">cout</span> &lt;&lt; <span class="string">"æ¥æ”¶æ•°æ®ï¼š"</span> &lt;&lt; receivedData &lt;&lt;<span class="built_in">endl</span>;  </span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; <span class="string">"è¯·è¾“å…¥é€‰é¡¹: "</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">calculateChecksum</span><span class="params">(<span class="keyword">int</span>* hexArray, <span class="keyword">int</span> length)</span> </span>&#123;</span><br><span class="line">	<span class="comment">// è®¡ç®—å¼‚æˆ–æ ¡éªŒå’Œ</span></span><br><span class="line">    <span class="keyword">int</span> checksum = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; length; ++i) &#123;</span><br><span class="line">        checksum ^= hexArray[i];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">stringstream</span> ss;</span><br><span class="line">	<span class="comment">//ä½¿ç”¨å­—ç¬¦ä¸²æµæ“ä½œæ•°æ®å¸§</span></span><br><span class="line">    ss &lt;&lt; hex &lt;&lt; checksum;</span><br><span class="line">    <span class="keyword">int</span> hexChecksum;</span><br><span class="line">    ss &gt;&gt; hex &gt;&gt; hexChecksum;  </span><br><span class="line">    <span class="keyword">return</span> hexChecksum;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">decimalToHexArray</span><span class="params">(<span class="keyword">int</span> decimal, <span class="keyword">int</span>* hexArray, <span class="keyword">int</span> index)</span> </span>&#123;</span><br><span class="line">	<span class="comment">// è¿›åˆ¶è½¬æ¢ï¼Œåè¿›åˆ¶è½¬ä¸ºåå…­è¿›åˆ¶ï¼Œå¹¶æ·»åŠ å‰å¯¼0</span></span><br><span class="line">    <span class="built_in">stringstream</span> ss;</span><br><span class="line">    ss &lt;&lt; hex &lt;&lt; setfill(<span class="string">'0'</span>) &lt;&lt; setw(<span class="number">2</span>) &lt;&lt; decimal;</span><br><span class="line">    <span class="keyword">int</span> hexValue;</span><br><span class="line">    ss &gt;&gt; hex &gt;&gt; hexValue;  </span><br><span class="line">    hexArray[index] = hexValue;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="built_in">wstring</span> comPort;</span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; <span class="string">"è¯·è¾“å…¥COMç«¯å£ï¼ˆå¦‚COM3ï¼‰ï¼š"</span>;</span><br><span class="line">    getline(wcin, comPort);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">int</span> baudRate;</span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; <span class="string">"è¯·è¾“å…¥æ³¢ç‰¹ç‡ï¼ˆå¦‚9600ï¼‰ï¼š"</span>;</span><br><span class="line">    <span class="built_in">cin</span> &gt;&gt; baudRate;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (!initSerialPort(comPort, baudRate)) &#123;</span><br><span class="line">        <span class="built_in">cerr</span> &lt;&lt; <span class="string">"åˆå§‹åŒ–ä¸²å£å¤±è´¥!\n"</span>;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">string</span> carStatus = <span class="string">"æœªçŸ¥"</span>;</span><br><span class="line">	</span><br><span class="line">    <span class="keyword">double</span> PWM_L = <span class="number">0.0</span>, PWM_R = <span class="number">0.0</span>, Speed_L = <span class="number">0.0</span>, Speed_R = <span class="number">0.0</span>;</span><br><span class="line">	<span class="comment">//åˆå§‹åŒ–å°è½¦çŠ¶æ€</span></span><br><span class="line">    displayMenuAndStatus(carStatus, PWM_L, PWM_R, Speed_L, Speed_R);</span><br><span class="line">    <span class="keyword">while</span> (<span class="literal">true</span>) &#123;</span><br><span class="line">		res:</span><br><span class="line">		processSerialData(carStatus, PWM_L, PWM_R, Speed_L, Speed_R);</span><br><span class="line">		processSerialData(carStatus, PWM_L, PWM_R, Speed_L, Speed_R);</span><br><span class="line">		processSerialData(carStatus, PWM_L, PWM_R, Speed_L, Speed_R);</span><br><span class="line">		processSerialData(carStatus, PWM_L, PWM_R, Speed_L, Speed_R);</span><br><span class="line">		processSerialData(carStatus, PWM_L, PWM_R, Speed_L, Speed_R);</span><br><span class="line">		processSerialData(carStatus, PWM_L, PWM_R, Speed_L, Speed_R);</span><br><span class="line">		processSerialData(carStatus, PWM_L, PWM_R, Speed_L, Speed_R);</span><br><span class="line">		<span class="comment">//å¤„ç†ä¸²å£å›ä¼ æ•°æ®</span></span><br><span class="line">        displayMenuAndStatus(carStatus, PWM_L, PWM_R, Speed_L, Speed_R);</span><br><span class="line">		<span class="comment">//èœå•ä¸å°è½¦çŠ¶æ€æ˜¾ç¤º</span></span><br><span class="line">        <span class="keyword">int</span> choice;</span><br><span class="line">        <span class="built_in">cin</span> &gt;&gt; choice;</span><br><span class="line">		processSerialData(carStatus, PWM_L, PWM_R, Speed_L, Speed_R);</span><br><span class="line">		processSerialData(carStatus, PWM_L, PWM_R, Speed_L, Speed_R);</span><br><span class="line">		processSerialData(carStatus, PWM_L, PWM_R, Speed_L, Speed_R);</span><br><span class="line">		processSerialData(carStatus, PWM_L, PWM_R, Speed_L, Speed_R);</span><br><span class="line">		processSerialData(carStatus, PWM_L, PWM_R, Speed_L, Speed_R);</span><br><span class="line">        <span class="keyword">switch</span> (choice) &#123;</span><br><span class="line">            <span class="keyword">case</span> <span class="number">1</span>:</span><br><span class="line">                sendCommandToESP32(<span class="string">"FORWARD"</span>);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="number">2</span>:</span><br><span class="line">                sendCommandToESP32(<span class="string">"BACKWARD"</span>);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="number">3</span>:</span><br><span class="line">                sendCommandToESP32(<span class="string">"LEFT"</span>);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="number">4</span>:</span><br><span class="line">                sendCommandToESP32(<span class="string">"RIGHT"</span>);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="number">5</span>: &#123;</span><br><span class="line">                <span class="keyword">int</span> hexValue[] = &#123;<span class="number">0xAA</span>, <span class="number">0x01</span>, <span class="number">0xFF</span>, <span class="number">0x00</span>, <span class="number">0xFF</span>, <span class="number">0xAB</span>&#125;;</span><br><span class="line">                sendHexCommandToESP32(hexValue);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">case</span> <span class="number">6</span>: &#123;</span><br><span class="line">                <span class="keyword">int</span> hexValue[] = &#123;<span class="number">0xAA</span>, <span class="number">0x00</span>, <span class="number">0xFF</span>, <span class="number">0x01</span>, <span class="number">0xFF</span>, <span class="number">0xAB</span>&#125;;</span><br><span class="line">                sendHexCommandToESP32(hexValue);</span><br><span class="line">				<span class="comment">//å‘ä¸²å£å‘é€æ•°æ®å¸§</span></span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">case</span> <span class="number">7</span>: &#123;</span><br><span class="line">				<span class="comment">//è°ƒé€ŸäºŒçº§èœå•</span></span><br><span class="line">				<span class="keyword">int</span> leftPWM, rightPWM, flag = <span class="number">1</span>, inp;</span><br><span class="line">                <span class="keyword">int</span> leftStatus, rightStatus;</span><br><span class="line">				<span class="keyword">while</span>(flag) &#123;</span><br><span class="line">					system(<span class="string">"cls"</span>);</span><br><span class="line">					<span class="built_in">cout</span> &lt;&lt; <span class="string">"è°ƒé€Ÿèœå•"</span> &lt;&lt;<span class="built_in">endl</span>;</span><br><span class="line">					<span class="built_in">cout</span> &lt;&lt; <span class="string">"1. pwmåŒè½®è°ƒé€Ÿ\n"</span>;</span><br><span class="line">					<span class="built_in">cout</span> &lt;&lt; <span class="string">"2. æ•°æ®å¸§å•è½®è°ƒé€Ÿ\n"</span>;</span><br><span class="line">					<span class="built_in">cout</span> &lt;&lt; <span class="string">"3. è¿”å›ä¸Šä¸€çº§\nè¯·é€‰æ‹©åºå·ï¼š"</span>;</span><br><span class="line">					<span class="built_in">cin</span> &gt;&gt; inp;</span><br><span class="line">					<span class="keyword">if</span>(inp == <span class="number">2</span>)&#123;</span><br><span class="line">						<span class="built_in">cout</span> &lt;&lt; <span class="string">"è¯·è¾“å…¥å·¦è½®æ–¹å‘ 1:æ­£ï¼Œ0ï¼šåï¼š"</span>;</span><br><span class="line">						<span class="built_in">cin</span> &gt;&gt; leftStatus;</span><br><span class="line">						<span class="built_in">cout</span> &lt;&lt; <span class="string">"è¯·è¾“å…¥å·¦è½®é€Ÿåº¦ (0-255): "</span>;</span><br><span class="line">						<span class="built_in">cin</span> &gt;&gt; leftPWM;</span><br><span class="line">						<span class="built_in">cout</span> &lt;&lt; <span class="string">"è¯·è¾“å…¥å³è½®æ–¹å‘ 1:æ­£ï¼Œ0ï¼šåï¼š"</span>;</span><br><span class="line">						<span class="built_in">cin</span> &gt;&gt; rightStatus;</span><br><span class="line">						<span class="built_in">cout</span> &lt;&lt; <span class="string">"è¯·è¾“å…¥å³è½®é€Ÿåº¦ (0-255): "</span>;</span><br><span class="line">						<span class="built_in">cin</span> &gt;&gt; rightPWM;   </span><br><span class="line">						<span class="comment">//ä½¿ç”¨æ•°æ®å¸§å¯¹å·¦å³è½®åˆ†åˆ«è°ƒé€Ÿ</span></span><br><span class="line">						<span class="keyword">int</span> hexValue[<span class="number">6</span>];</span><br><span class="line">						hexValue[<span class="number">0</span>] = <span class="number">0XAA</span>;</span><br><span class="line">						hexValue[<span class="number">1</span>] = (leftStatus == <span class="number">1</span>)? <span class="number">0x01</span> : <span class="number">0x00</span>;  <span class="comment">//å·¦è½®è½¬åŠ¨çŠ¶æ€</span></span><br><span class="line">						decimalToHexArray(leftPWM, hexValue, <span class="number">2</span>);       <span class="comment">//å·¦è½®é€Ÿåº¦</span></span><br><span class="line">						hexValue[<span class="number">3</span>] = (rightStatus == <span class="number">1</span>)? <span class="number">0x01</span> : <span class="number">0x00</span>; <span class="comment">//å³è½®è½¬åŠ¨çŠ¶æ€</span></span><br><span class="line">						decimalToHexArray(rightPWM, hexValue, <span class="number">4</span>);      <span class="comment">//å³è½®é€Ÿåº¦</span></span><br><span class="line">						hexValue[<span class="number">5</span>] = calculateChecksum(hexValue, <span class="number">5</span>);  <span class="comment">//å¼‚æˆ–æ ¡éªŒä½					</span></span><br><span class="line">						sendHexCommandToESP32(hexValue);</span><br><span class="line">					&#125;</span><br><span class="line">					<span class="keyword">else</span> <span class="keyword">if</span>(inp == <span class="number">1</span>)&#123;</span><br><span class="line">						<span class="keyword">int</span> pwm;</span><br><span class="line">						<span class="built_in">cout</span> &lt;&lt; <span class="string">"è¯·è¾“å…¥é€Ÿåº¦:"</span>;</span><br><span class="line">						<span class="built_in">cin</span> &gt;&gt; pwm;</span><br><span class="line">						<span class="keyword">if</span> (pwm &gt;= <span class="number">0</span> &amp;&amp; pwm &lt;= <span class="number">255</span>) &#123;</span><br><span class="line">						<span class="keyword">char</span> command[<span class="number">50</span>];</span><br><span class="line">						sprintf_s(command, <span class="keyword">sizeof</span>(command), <span class="string">"PWM %d"</span>, pwm);</span><br><span class="line">						sendCommandToESP32(command);</span><br><span class="line">						&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">						<span class="built_in">cout</span> &lt;&lt; <span class="string">"é€Ÿåº¦è¶…å‡ºèŒƒå›´ï¼Œè¯·é‡æ–°è¾“å…¥ã€‚\n"</span>;</span><br><span class="line">						&#125;</span><br><span class="line">					&#125;</span><br><span class="line">					<span class="keyword">else</span> <span class="keyword">if</span>(inp == <span class="number">3</span>) flag = <span class="number">0</span>;</span><br><span class="line">				&#125;</span><br><span class="line">					processSerialData(carStatus, PWM_L, PWM_R, Speed_L, Speed_R);</span><br><span class="line">					processSerialData(carStatus, PWM_L, PWM_R, Speed_L, Speed_R);</span><br><span class="line">					processSerialData(carStatus, PWM_L, PWM_R, Speed_L, Speed_R);</span><br><span class="line">					processSerialData(carStatus, PWM_L, PWM_R, Speed_L, Speed_R);</span><br><span class="line">					processSerialData(carStatus, PWM_L, PWM_R, Speed_L, Speed_R);</span><br><span class="line">					processSerialData(carStatus, PWM_L, PWM_R, Speed_L, Speed_R);</span><br><span class="line">					processSerialData(carStatus, PWM_L, PWM_R, Speed_L, Speed_R);</span><br><span class="line">					processSerialData(carStatus, PWM_L, PWM_R, Speed_L, Speed_R);</span><br><span class="line">					processSerialData(carStatus, PWM_L, PWM_R, Speed_L, Speed_R);</span><br><span class="line">					processSerialData(carStatus, PWM_L, PWM_R, Speed_L, Speed_R);</span><br><span class="line">					processSerialData(carStatus, PWM_L, PWM_R, Speed_L, Speed_R);</span><br><span class="line">					processSerialData(carStatus, PWM_L, PWM_R, Speed_L, Speed_R);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">			<span class="keyword">case</span> <span class="number">8</span>:</span><br><span class="line">                sendCommandToESP32(<span class="string">"STOP"</span>);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">			<span class="keyword">case</span> <span class="number">9</span>: <span class="keyword">goto</span> res; <span class="keyword">break</span>;</span><br><span class="line">			<span class="comment">//åˆ·æ–°å°è½¦çŠ¶æ€</span></span><br><span class="line">            <span class="keyword">case</span> <span class="number">0</span>:</span><br><span class="line">                closeSerialPort(); </span><br><span class="line">				<span class="comment">// åœ¨é€€å‡ºå‰å…³é—­ä¸²å£</span></span><br><span class="line">                <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">default</span>:</span><br><span class="line">                <span class="built_in">cout</span> &lt;&lt; <span class="string">"æ— æ•ˆçš„é€‰é¡¹ï¼Œè¯·é‡æ–°é€‰æ‹©ã€‚\n"</span>;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
### serial.cpp
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">ifndef</span> SERIAL_H</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> SERIAL_H</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;windows.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// åˆå§‹åŒ–æŒ‡å®šçš„ä¸²å£å¹¶è¿”å›æˆåŠŸä¸å¦</span></span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">initSerialPort</span><span class="params">(<span class="keyword">const</span> <span class="built_in">std</span>::<span class="built_in">wstring</span>&amp; portName, DWORD baudRate)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å‘é€å‘½ä»¤åˆ°ESP32</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">sendCommandToESP32</span><span class="params">(<span class="keyword">const</span> <span class="keyword">char</span>* command)</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">sendHexCommandToESP32</span><span class="params">(<span class="keyword">const</span> <span class="keyword">int</span>* command)</span></span>;</span><br><span class="line"><span class="comment">// æ¥å—å‘½ä»¤</span></span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">receiveDataFromESP32</span><span class="params">(<span class="built_in">std</span>::<span class="built_in">string</span>&amp; receivedData)</span></span>;</span><br><span class="line"><span class="comment">// </span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">processSerialData</span><span class="params">(<span class="built_in">std</span>::<span class="built_in">string</span>&amp; carStatus,<span class="keyword">double</span>&amp; PWM_L,<span class="keyword">double</span>&amp; PWM_R,<span class="keyword">double</span>&amp; Speed_L,<span class="keyword">double</span>&amp; Speed_R)</span></span>;</span><br><span class="line"><span class="comment">// å…³é—­ä¸²å£</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">closeSerialPort</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span> <span class="comment">// SERIAL_H</span></span></span><br></pre></td></tr></table></figure>
### serial.h
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">ifndef</span> SERIAL_H</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> SERIAL_H</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;windows.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// åˆå§‹åŒ–æŒ‡å®šçš„ä¸²å£å¹¶è¿”å›æˆåŠŸä¸å¦</span></span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">initSerialPort</span><span class="params">(<span class="keyword">const</span> <span class="built_in">std</span>::<span class="built_in">wstring</span>&amp; portName, DWORD baudRate)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å‘é€å‘½ä»¤åˆ°ESP32</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">sendCommandToESP32</span><span class="params">(<span class="keyword">const</span> <span class="keyword">char</span>* command)</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">sendHexCommandToESP32</span><span class="params">(<span class="keyword">const</span> <span class="keyword">int</span>* command)</span></span>;</span><br><span class="line"><span class="comment">// æ¥å—å‘½ä»¤</span></span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">receiveDataFromESP32</span><span class="params">(<span class="built_in">std</span>::<span class="built_in">string</span>&amp; receivedData)</span></span>;</span><br><span class="line"><span class="comment">// </span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">processSerialData</span><span class="params">(<span class="built_in">std</span>::<span class="built_in">string</span>&amp; carStatus,<span class="keyword">double</span>&amp; PWM_L,<span class="keyword">double</span>&amp; PWM_R,<span class="keyword">double</span>&amp; Speed_L,<span class="keyword">double</span>&amp; Speed_R)</span></span>;</span><br><span class="line"><span class="comment">// å…³é—­ä¸²å£</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">closeSerialPort</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span> <span class="comment">// SERIAL_H</span></span></span><br></pre></td></tr></table></figure>
<h2 id="Features">Features</h2>
<p>The design results of the ESP32 Smart Car Control System basically meet the expected requirements. The commands are sent accurately and successfully achieve operations such as moving forward, backward, turning, and PWM speed adjustment. The XOR checksum calculation for data frames is precise and efficient. The parsing of the carâ€™s status is basically correct, and it can clearly display the carâ€™s speed and direction on the console. The system exhibits excellent robustness, promptly reporting error messages for out-of-bound data, and possesses high memory safety. However, the system still faces occasional errors in car status discrimination and delays in receiving data transmitted back from the car, which are currently difficult to resolve. In the future, we will further improve the systemâ€™s functionality by delving deeper into hardware logic and software algorithm knowledge to rewrite and refactor the code.</p>
<h2 id="Issues-and-Solutions">Issues and Solutions</h2>
<h3 id="The-single-digit-numbers-in-the-data-frame-lack-a-leading-â€œ0â€-placeholder-making-it-unrecognizable-by-the-car">The single-digit numbers in the data frame lack a leading â€œ0â€ placeholder, making it unrecognizable by the car.</h3>
<p>Solution: By consulting literature, it was decided to use the stringstream class from the C++ standard library, analogous to the usage of the setfill() function in the iostream stream for homework assignments. Specifically, a string stream was used to add a leading â€œ0â€ before single digits to achieve precise placeholder formatting.<br>
Specific implementation code:</p>
   <figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">ss &lt;&lt; hex &lt;&lt; setfill(<span class="string">'0'</span>) &lt;&lt; setw(<span class="number">2</span>) &lt;&lt; decimal;</span><br><span class="line"><span class="keyword">int</span> hexValue;</span><br><span class="line">ss &gt;&gt; hex &gt;&gt; hexValue;</span><br><span class="line">hexArray[index] = hexValue;</span><br></pre></td></tr></table></figure>
<h3 id="The-original-serial-port-sending-function-could-not-send-integer-data-frames">The original serial port sending function could not send integer data frames.</h3>
<p>Solution: A new serial port sending function was written to send an integer array to the ESP32 microcontroller. This function accepts the base address of an integer array and removes carriage returns when sending information.<br>
Specific implementation code:</p>
   <figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">sendHexCommandToESP32</span><span class="params">(<span class="keyword">const</span> <span class="keyword">int</span>* command)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (hSerial == INVALID_HANDLE_VALUE) &#123;</span><br><span class="line">        <span class="built_in">std</span>::<span class="built_in">cerr</span> &lt;&lt; <span class="string">"Serial port not initialized."</span> &lt;&lt; <span class="built_in">std</span>::<span class="built_in">endl</span>;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    DWORD bytesWritten;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">6</span>; i++) &#123;</span><br><span class="line">        WriteFile(hSerial, command + i, <span class="number">1</span>, &amp;bytesWritten, <span class="literal">NULL</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="Incorrect-data-transmitted-back-from-the-smart-car-simulator">Incorrect data transmitted back from the smart car simulator.</h3>
<p>The smart car simulator transmits data like this: PWM_L = 255, Speed_L = 38, STOP; PWM_R = 255, Speed_R = 38, STOP. The status is STOP, but the speed is not zero, indicating incorrect data transmission.<br>
Solution: In the car status judgment part, recognition of â€œSTOPâ€ was added to improve the accuracy of status discrimination.</p>
   <figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">else</span> <span class="keyword">if</span> ((PWM_L == <span class="number">0</span> &amp;&amp; PWM_R == <span class="number">0</span>) || receivedData.find(<span class="string">"STOP"</span>) != <span class="built_in">std</span>::<span class="built_in">string</span>::npos)</span><br><span class="line">    carStatus = <span class="string">"Stopped"</span>;</span><br></pre></td></tr></table></figure>
<h3 id="Delay-in-receiving-and-judging-the-carâ€™s-status">Delay in receiving and judging the carâ€™s status.</h3>
<p>The serial port information receiving function receiveDataFromESP32() has significant delay in receiving information.<br>
Solution: A â€œRefresh Statusâ€ option was added to the menu to improve the timeliness of status recognition by multiple acquisitions of data transmitted back from the microcontroller. However, there is currently no feasible solution for the delay itself, and the system functionality needs further improvement.</p>
<h2 id="Reflection">Reflection</h2>
<p>During the design process of the ESP32 smart car control system, I deeply experienced the charm of combining hardware and software. By programming to control the behavior of hardware, realizing functions such as the carâ€™s forward, backward, turning, and PWM speed adjustment, I felt the infinite possibilities of technology. However, in the actual design process, I also encountered many challenges, such as how to accurately read the carâ€™s status data, how to accurately calculate the XOR checksum, and how to stably control the motors. Through consulting materials, debugging code, and algorithm optimization, I gradually overcame these difficulties. During the design process, I also constantly tried out new ideas in my mind, cultivated innovation and exploration spirit, and improved my problem-solving abilities and practical skills in C++ programming.</p>
<h2 id="Suggestions">Suggestions</h2>
<ul>
<li>More practical sessions should be added to the course, giving students more opportunities to hands-on operate hardware, write code, and debug systems. Only through practice can students gain a deeper understanding of theoretical knowledge and improve their innovative practical abilities.</li>
<li>Some team collaboration projects should be set up in the course, giving students opportunities to exercise their team collaboration and communication skills in practice. Teachers can also provide some team collaboration tips and methods to help students better cooperate with others.</li>
<li>Some application case analyses of smart car control systems can be added to the course, allowing students to understand practical application scenarios. Through discussion and analysis, students can gain a deeper understanding of the design principles and implementation methods of the system, and also stimulate their innovative thinking and improve their problem-solving abilities.</li>
</ul>
</div><div class="post-footer"><div class="meta"><div class="info"><i class="fa fa-sun-o"></i><span class="date">2025-01-23</span><i class="fa fa-comment-o"></i><a href="/ESP32-smartCarController/#comments">è¯„è®º</a><i class="fa fa-tag"></i><a class="tag" href="/tags/ç¼–ç¨‹/" title="ç¼–ç¨‹">ç¼–ç¨‹ </a></div></div></div></div><div class="share"><div class="evernote"><a class="fa fa-bookmark" href="javascript:(function(){EN_CLIP_HOST='http://www.evernote.com';try{var%20x=document.createElement('SCRIPT');x.type='text/javascript';x.src=EN_CLIP_HOST+'/public/bookmarkClipper.js?'+(new%20Date().getTime()/100000);document.getElementsByTagName('head')[0].appendChild(x);}catch(e){location.href=EN_CLIP_HOST+'/clip.action?url='+encodeURIComponent(location.href)+'&amp;title='+encodeURIComponent(document.title);}})();" ref="nofollow" target="_blank"></a></div><div class="weibo"><a class="fa fa-weibo" href="javascript:void((function(s,d,e){try{}catch(e){}var f='http://service.weibo.com/share/share.php?',u=d.location.href,p=['url=',e(u),'&amp;title=',e(d.title),'&amp;appkey=2924220432'].join('');function a(){if(!window.open([f,p].join(''),'mb',['toolbar=0,status=0,resizable=1,width=620,height=450,left=',(s.width-620)/2,',top=',(s.height-450)/2].join('')))u.href=[f,p].join('');};if(/Firefox/.test(navigator.userAgent)){setTimeout(a,0)}else{a()}})(screen,document,encodeURIComponent));"></a></div><div class="twitter"><a class="fa fa-twitter" href="http://twitter.com/home?status=,https://liuboyuan.fun/ESP32-smartCarController/,è´Ÿé›¨æ‚æ„Ÿ,ğŸš—åŸºäºC++çš„ESP32å°è½¦æ§åˆ¶ç³»ç»Ÿ,;" target="_blank" rel="noopener"></a></div></div><div class="pagination"><ul class="clearfix"><li class="pre pagbuttons"><a class="btn" role="navigation" href="/cpp-2024/" title="ğŸ’»C++ç¨‹åºè®¾è®¡ä¹ é¢˜ä¸é¢˜è§£">ä¸Šä¸€ç¯‡</a></li><li class="next pagbuttons"><a class="btn" role="navigation" href="/journeytoshandong/" title="â›°ï¸é½é²æ¸¸è®°">ä¸‹ä¸€ç¯‡</a></li></ul></div><a id="comments"></a><div id="disqus_thread"></div><script>var disqus_shortname = 'misthrain';
var disqus_identifier = 'ESP32-smartCarController/';
var disqus_title = 'ğŸš—åŸºäºC++çš„ESP32å°è½¦æ§åˆ¶ç³»ç»Ÿ';
var disqus_url = 'https://liuboyuan.fun/ESP32-smartCarController/';
(function() {
    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();</script><script id="dsq-count-scr" src="//#{theme.disqus}.disqus.com/count.js" async></script></div></div></div></div><script src="/js/jquery.js"></script><script src="/js/jquery-migrate-1.2.1.min.js"></script><script src="/js/jquery.appear.js"></script></body></html>